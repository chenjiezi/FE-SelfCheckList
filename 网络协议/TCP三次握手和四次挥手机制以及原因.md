- 三次握手
  -  一开始，客户端和服务端都处于 `CLOSED` 状态。先是服务端主动监听某个端口，处于 `LISTEN` 状态 
  - 第一次握手： 客户端将 `SYN ` 报文发送给服务端，表示向服务端发起连接，之后客户端处于（同步发送） `SYN-SENT` 状态。 
  -  第二次握手：服务端收到客户端的 `SYN`  报文后，接着把 `SYN` 和 `ACK` 报文发给客户端，之后服务端处于（同步接收） `SYN-RCVD` 状态。 
  -  第三次握手：客户端收到服务端报文后，还要向服务端回应最后一个应答报文，最后把`ACK` 报文发送给服务端，之后客户端处于 （建立）`ESTABLISHED` 状态。 
  -  服务器收到客户端的应答报文后，也进入 （建立）`ESTABLISHED` 状态。 
- 四次挥手
  - 第一次挥手：客户端打算关闭连接，此时会发送一个 TCP 首部 `FIN` 标志位被置为 `1` 的报文，也即 `FIN` 报文，之后客户端进入 `FIN_WAIT_1` 状态。

  - 第二次挥手：服务端收到该报文后，就向客户端发送 `ACK` 应答报文，接着服务端进入 `CLOSED_WAIT` 状态。客户端收到服务端的 `ACK` 应答报文后，之后进入 `FIN_WAIT_2` 状态。
  - 第三次挥手：等待服务端处理完数据后，也向客户端发送 `FIN` 报文，之后服务端进入 `LAST_ACK` 状态。

  - 第四次挥手：客户端收到服务端的 `FIN` 报文后，回一个 `ACK` 应答报文，之后进入 `TIME_WAIT` 状态。

    服务器收到了 `ACK` 应答报文后，就进入了 `CLOSE` 状态，至此服务端已经完成连接的关闭。

    客户端在经过 `2MSL` 一段时间后，自动进入 `CLOSE` 状态，至此客户端也完成连接的关闭。
- 建立连接为什么要三次握手？为什么不是两次？
  - 因为TCP是全双工通信，双方需要先确认彼此都可以发送和接收到对方的信息，确认完才可以进行数据传输；
  - 如果建立连接时两次握手的话，遇到网络堵塞时，Client 以为没有连接上，发送多次请求，而 Server 会为前面多次无效请求创建连接，造成资源浪费；
- 为什么连接的时候是三次握手，关闭的时候却是四次握手？
  - 因为当 Server 端收到 Client 端的 SYN 连接请求报文后，可以直接发送 SYN+ACK 报文。（其中ACK 报文是用来应答的， SYN 报文是用来同步的）
  - 但是关闭连接时，当 Server 端收到 FIN 报文时，很可能并不会立即关闭 SOCKET，所以只能先回复一个 ACK 报文，告诉 CLient 端，“你发的 FIN 报文我收到了”。只有等到我 Server 端所有的报文都发送完了，我才能发送 FIN 报文，因此不能一起发送。所以需要四步握手。
- 为什么 TIME_WAIT 状态需要经过2 MSL（最大报文段生存时间）才能到 CLOSE 状态？
  - 虽然按道理，四个报文都发送完毕，我们可以直接 进入 CLOSE 状态了，但是网络传输是不可靠的，有可能最后一个 ACK 丢失了。所以TIME_WAIT状态就是用来重发可能丢失的 ACK 报文。
